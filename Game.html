<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fruit Slice - Final Edition</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: linear-gradient(to bottom, #def3ff, #a2d4f5);
      overflow: hidden;
      touch-action: none;
    }
    h1, #score, #timer {
      text-align: center;
      margin: 0.5em;
    }
    #gameArea {
      position: relative;
      width: 100%;
      height: 75vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      border-top: 3px solid #000;
      border-bottom: 3px solid #000;
    }
    #fallZone {
      position: relative;
      width: 400px;
      height: 100%;
      background-image: url('img/board.png');
      background-size: cover;
      background-position: center;
      border-radius: 20px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    #bottomLine {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 6px;
      background: rgba(255, 0, 0, 0.4);
      pointer-events: none;
    }
    .fruit {
      width: 60px;
      height: 60px;
      position: absolute;
      cursor: pointer;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      transition: transform 0.2s ease-out, opacity 0.2s ease-out;
    }
    .legendary {
      box-shadow: 0 0 15px 5px gold;
      animation: glow 1s ease-in-out infinite alternate;
    }
    .bomb {
      background-image: url('img/bomb.png');
    }
    @keyframes glow {
      from { box-shadow: 0 0 10px 2px gold; }
      to   { box-shadow: 0 0 20px 6px yellow; }
    }
    .sliced {
      transform: scale(1.3) rotate(45deg);
      opacity: 0;
    }
    .splash-drop {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      opacity: 1;
      animation: splashAnim 0.5s ease-out forwards;
    }
    @keyframes splashAnim {
      to {
        transform: translate(var(--x), var(--y)) scale(1.5);
        opacity: 0;
      }
    }
    #startBtn, #exitBtn {
      display: inline-block;
      margin: 10px 10px;
      padding: 12px 25px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: white;
    }
    #startBtn {
      background-color: #28a745;
    }
    #exitBtn {
      background-color: #dc3545;
    }
    #swordTrail {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 999;
    }
    @media (max-width: 768px) {
      #fallZone {
        width: 95%;
      }
      .fruit {
        width: 50px;
        height: 50px;
      }
      #startBtn, #exitBtn {
        width: 90%;
        margin: 10px auto;
      }
    }
  </style>
</head>
<body>
<h1>üçì Fruit Slice ‚Äì Final Edition</h1>
<div id="score">Score: 0</div>
<div id="timer">Time Left: 30s</div>
<button id="startBtn" onclick="startGame()">Start Game</button>
<button id="exitBtn" onclick="exitGame()" style="display: none;">Exit Game</button>
<div id="gameArea">
  <div id="fallZone">
    <div id="bottomLine"></div>
  </div>
</div>
<svg id="swordTrail">
  <path id="trailPath" stroke="red" stroke-width="5" fill="none" stroke-linecap="round" stroke-linejoin="round" />
</svg>
<audio id="sliceSound" src="https://www.fesliyanstudios.com/play-mp3/387" preload="auto"></audio>
<script>
  const fruitList = [
    { img: 'img/apple.png', type: 'normal' },
    { img: 'img/banana.png', type: 'normal' },
    { img: 'img/orange.png', type: 'normal' },
    { img: 'img/strawberry.png', type: 'normal' },
    { img: 'img/basket.png', type: 'legendary' },
    { img: 'img/bomb.png', type: 'bomb' }
  ];
  const fallZone = document.getElementById("fallZone");
  const scoreDisplay = document.getElementById("score");
  const timerDisplay = document.getElementById("timer");
  const sliceSound = document.getElementById("sliceSound");
  const trailPath = document.getElementById("trailPath");
  let score = 0;
  let timeLeft = 30;
  let gameInterval, countdownInterval;
  let gameRunning = false;
  let lastSliceTime = 0;
  let trailPoints = [];
  let fallSpeedMultiplier = 1;

  function updateTimer() {
    timerDisplay.textContent = "Time Left: " + timeLeft + "s";
  }

  function createFruit() {
    const fruit = document.createElement("div");
    fruit.classList.add("fruit");
    const chosen = fruitList[Math.floor(Math.random() * fruitList.length)];
    const isLegendary = chosen.type === 'legendary';
    const isBomb = chosen.type === 'bomb';
    fruit.dataset.type = chosen.type;
    fruit.style.backgroundImage = `url(${chosen.img})`;
    if (isLegendary) fruit.classList.add("legendary");
    if (isBomb) fruit.classList.add("bomb");
    fruit.dataset.sliced = "false";
    const leftPosition = Math.random() * (fallZone.clientWidth - 60);
    fruit.style.left = leftPosition + "px";
    fruit.style.top = "-60px";
    let fallSpeed = (Math.random() * 2 + 2) * fallSpeedMultiplier;
    fallZone.appendChild(fruit);
    const fall = setInterval(() => {
      let top = parseFloat(fruit.style.top);
      fruit.style.top = top + fallSpeed + "px";
      if (top >= fallZone.clientHeight - fruit.offsetHeight && fruit.dataset.sliced !== "true") {
        fruit.remove();
        clearInterval(fall);
      }
    }, 16);

    function slice() {
      if (fruit.dataset.sliced === "true") return;
      fruit.dataset.sliced = "true";
      let now = Date.now();
      let timeDiff = now - lastSliceTime;
      lastSliceTime = now;
      if (isLegendary) {
        score += 5;
        timeLeft += 2;
      } else if (isBomb) {
        endGame("üí• You sliced a bomb! Game Over. Score: " + score);
        return;
      } else {
        score += timeDiff < 500 ? 2 : 1;
      }
      scoreDisplay.textContent = "Score: " + score;
      updateTimer();
      sliceSound.currentTime = 0;
      sliceSound.play();
      fruit.classList.add("sliced");
      const left = parseFloat(fruit.style.left);
      const top = parseFloat(fruit.style.top);
      createSplash(left + 30, top + 30, isLegendary ? 'gold' : isBomb ? 'black' : 'red');
      setTimeout(() => fruit.remove(), 200);
      clearInterval(fall);
    }

    fruit.addEventListener("click", slice);
    fruit.addEventListener("touchstart", slice);
  }

  function createSplash(x, y, color) {
    for (let i = 0; i < 10; i++) {
      const drop = document.createElement("div");
      drop.classList.add("splash-drop");
      drop.style.background = color;
      drop.style.left = `${x}px`;
      drop.style.top = `${y}px`;
      const angle = Math.random() * 2 * Math.PI;
      const distance = Math.random() * 50 + 10;
      const dx = Math.cos(angle) * distance;
      const dy = Math.sin(angle) * distance;
      drop.style.setProperty('--x', `${dx}px`);
      drop.style.setProperty('--y', `${dy}px`);
      fallZone.appendChild(drop);
      setTimeout(() => drop.remove(), 500);
    }
  }

  function startGame() {
    if (gameRunning) return;
    gameRunning = true;
    score = 0;
    timeLeft = 30;
    lastSliceTime = 0;
    trailPoints = [];
    fallSpeedMultiplier = 1;
    updateTimer();
    scoreDisplay.textContent = "Score: 0";
    document.getElementById("exitBtn").style.display = "inline-block";

    gameInterval = setInterval(() => {
      createFruit();
      fallSpeedMultiplier += 0.01; // increase speed gradually
    }, 700);

    countdownInterval = setInterval(() => {
      timeLeft--;
      updateTimer();
      if (timeLeft <= 0) {
        clearInterval(countdownInterval);
        endGame("‚è∞ Time's up! Your score: " + score);
      }
    }, 1000);
  }

  function endGame(message) {
    clearInterval(gameInterval);
    clearInterval(countdownInterval);
    gameRunning = false;
    document.getElementById("exitBtn").style.display = "none";
    alert(message);
    [...document.querySelectorAll('.fruit')].forEach(f => f.remove());
    trailPoints = [];
  }

  function exitGame() {
    if (confirm("Are you sure you want to exit the game?")) {
      endGame("Game exited. Your score: " + score);
    }
  }

  function detectSwipe(x, y) {
    trailPoints.push({ x, y, time: Date.now() });
    const elements = document.elementsFromPoint(x, y);
    elements.forEach(el => {
      if (el.classList.contains('fruit')) {
        el.click();
      }
    });
  }

  function updateTrail() {
    const now = Date.now();
    trailPoints = trailPoints.filter(p => now - p.time < 300);
    const path = trailPoints.map((p, i) => (i === 0 ? 'M' : 'L') + p.x + ' ' + p.y).join(' ');
    trailPath.setAttribute("d", path);
    requestAnimationFrame(updateTrail);
  }

  requestAnimationFrame(updateTrail);
  document.addEventListener("mousemove", e => detectSwipe(e.clientX, e.clientY));
  document.addEventListener("touchmove", e => {
    const touch = e.touches[0];
    detectSwipe(touch.clientX, touch.clientY);
  });
</script>
</body>
</html>
